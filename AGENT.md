# AGENT.md

## 目的
このドキュメントは、SasaTechのWEBサービス開発で使用するアーキテクチャをまとめたものである。Claudeの[Agent Skills](https://code.claude.com/docs/ja/skills)を活用し、SKILL.mdを最上位とした、ガイドとルールの2種類のドキュメント形式で構成する。

作業を始める前に、`skills/sasatech-next-architecture/SKILL.md`を確認すること。


## 文体と記述スタイル

### 基本原則
技術ドキュメントは、明確で簡潔、かつ実用的である必要がある。以下の原則に従う：

- **明確さ優先**: 読者が迷わないよう、曖昧な表現を避ける
- **簡潔さ**: 冗長な説明や重複を排除する
- **実用性**: 具体的なコード例と実装方法を示す
- **一貫性**: 用語、形式、スタイルを統一する

### 文体ガイドライン

#### アクティブボイスを使用する
受動態ではなく能動態で記述する。

```markdown
NG: ファイルが作成される
OK: ファイルを作成する
```

#### 簡潔な文章を心がける
1文は短く、1つの内容に集中する。

```markdown
NG: このガイドでは、Feature-based Layer Architectureの実装方法について、
    具体的なコード例を交えながら詳しく説明していきます。
OK: このガイドでは、Feature-based Layer Architectureの実装方法を説明する。
    具体的なコード例を含む。
```

#### 現在形で記述する
「〜である」「〜する」の形式を使用する。

```markdown
NG: Handlerはリクエストを処理します
OK: Handlerはリクエストを処理する
```

#### 要求レベルの表現

| レベル | 表現 | 使用例 |
|--------|------|--------|
| 必須 | 〜する、必須、必要 | `server-only`を含める |
| 推奨 | 推奨、〜すべき | テストを追加することを推奨 |
| 任意 | 可能、〜できる | 追加の設定が可能 |
| 禁止 | 禁止、〜しない | `console.log`は使用しない |


## ドキュメント構成

### ディレクトリ構造
Skillのドキュメントは、以下の構造で整理する：

```
skills/
└── [skill-name]/
    ├── SKILL.md           # エントリポイント
    ├── guides/            # ガイド（HOW/WHY）
    │   ├── [guide-name].md
    │   ├── [guide-name]/  # 必要に応じて階層化
    │   │   ├── [detail-1].md
    │   │   ├── [detail-2].md
    │   │   └── [detail-3].md
    │   └── ...
    └── rules/             # ルール（DO/DON'T）
        ├── [category-name].md
        └── ...
templates/                 # ドキュメントテンプレート
├── guide-overview.md      # 概要レベルのガイド用
├── guide-detail.md        # 詳細レベルのガイド用
└── rule.md                # ルール用
```

ガイドは、必要に応じてサブディレクトリに階層化できる。概要レベルのガイドと詳細レベルのガイドを分離することで、読者が段階的に理解を深められる構成にする。

### ドキュメントの種類

#### ガイド vs ルール

| 項目 | ガイド | ルール |
|------|--------|--------|
| **目的** | アーキテクチャの理解を深める | 実装時の制約を定義する |
| **内容** | HOW/WHY — 設計思想、実装方法、コード例 | DO/DON'T — 判定基準、NG/OK例 |
| **形式** | チュートリアル形式 | 構造化されたルール形式 |
| **使用場面** | 学習時、設計判断時 | 実装時、コードレビュー時 |
| **配置** | `guides/` | `rules/` |

#### ガイドの役割
ガイドは、開発者がアーキテクチャを理解し、適切に実装するための学習リソースである：

- **Why（理由）**: なぜこのパターンを採用するのか
- **How（方法）**: どのように実装するのか
- **実例**: 実際のユースケースとコード例
- **ベストプラクティス**: 推奨パターンと避けるべきパターン

#### ルールの役割
ルールは、実装時の判断基準を明確にする：

- **制約の明示**: 何が許可され、何が禁止されるか
- **判定基準**: NG例とOK例で具体的に示す
- **優先度**: インパクトレベルで重要度を表現
- **分類**: カテゴリで検索性を確保


## Agent Teamによるドキュメント作成

ドキュメントの作成時は、以下の3つの専門エージェントで構成されるAgent Teamを使用する。

### エージェント構成

| エージェント | 役割 | 担当範囲 |
|-------------|------|----------|
| `guide-writer` | ガイド作成 | 概要ガイドと詳細ガイドの新規作成 |
| `rule-writer` | ルール作成 | ルールドキュメントの新規作成 |
| `proofreader` | 校正 | 文体・用語・整合性のレビューと修正 |

### 実行順序

```
Phase 1: guide-writer がガイドを作成（WHY/HOWを確立）
Phase 2: rule-writer が関連ルールを作成（DO/DON'Tを定義）
Phase 3: proofreader が両方をレビュー（整合性を検証）
```

Phase 1 → 2は依存関係がある。ガイドの設計思想をルールが参照するため、ガイドを先に作成する。Phase 3はPhase 1, 2の両方が完了してから実行する。

### 各エージェントの責務

- **guide-writer**: テンプレート（`templates/guide-overview.md`または`templates/guide-detail.md`）に準拠してガイドを作成する。完了後に`SKILL.md`のガイド一覧を更新する
- **rule-writer**: テンプレート（`templates/rule.md`）に準拠してルールを作成する。関連ガイドの設計思想と矛盾しないことを確認する。完了後に`SKILL.md`のルール一覧を更新する
- **proofreader**: 本ドキュメントのレビューチェックリストに基づいて校正する。新規ファイルは作成せず、既存ファイルの修正のみを行う


## SKILL.mdの構成

### 必須セクション

#### 1. Frontmatter
スキルのメタデータを定義する：

```yaml
---
name: skill-name
description: スキルの概要を1〜2文で記述
---
```

#### 2. アーキテクチャ概要
以下を含める：
- レイヤー構成図
- ディレクトリ構成
- 主要な技術スタック

#### 3. ガイドとルールの説明
2種類のドキュメント形式の違いを表で示す。

#### 4. ガイド一覧
各ガイドへのリンクと簡潔な説明を表形式で提供する：

```markdown
| ガイド | 説明 |
|--------|------|
| [ガイド名](guides/[guide-name].md) | ガイドの概要を簡潔に記述 |
```

#### 5. ルール一覧
カテゴリごとに整理し、インパクトレベルを明記する：

```markdown
| ルール | Impact | 説明 |
|--------|--------|------|
| [rule-id](rules/[rule-id].md) | CRITICAL/HIGH/MEDIUM/LOW | ルールの概要を簡潔に記述 |
```


## テンプレート

新しいドキュメントを作成する際は、`templates/`ディレクトリのテンプレートを使用する。テンプレートには必須セクションと推奨セクション（コメントアウト）が定義されている。

| テンプレート | 用途 | 必須セクション |
|-------------|------|---------------|
| [`templates/guide-overview.md`](templates/guide-overview.md) | 概要レベルのガイド | 概要、設計思想、構成、詳細ドキュメントへのリンク |
| [`templates/guide-detail.md`](templates/guide-detail.md) | 詳細レベルのガイド | 概要、設計思想、実装パターン、使用例（3つ以上） |
| [`templates/rule.md`](templates/rule.md) | ルール | Frontmatter、ルール、NG例、OK例、理由 |

### 使用手順

1. 対象のテンプレートをコピーする
2. `[プレースホルダー]`を実際の内容に置換する
3. 推奨セクション（コメントアウト部分）は、必要に応じてコメントを外して使用する
4. 不要な推奨セクションは削除する

### ガイドの種類

| 種類 | テンプレート | 説明 |
|------|-------------|------|
| 概要レベル | `guide-overview.md` | アーキテクチャや設計思想を説明する。詳細な実装例は含まず、詳細ガイドへのリンクを提供する |
| 詳細レベル | `guide-detail.md` | 特定の機能やレイヤーの実装方法を詳しく説明する。使用例を3つ以上含める |

### ルールのインパクトレベル

ルールのFrontmatterに記述する`impact`の定義：

| Impact | 基準 | 対応 |
|--------|------|------|
| **CRITICAL** | アーキテクチャの根幹に関わる。違反すると設計パターンが成立しない | 即座に修正が必要 |
| **HIGH** | 整合性や保守性を大きく損なう | リリース前に修正 |
| **MEDIUM** | コード品質や一貫性に影響する | 次回の改善で対応 |
| **LOW** | 開発体験やパターン統一に関する推奨 | 可能な範囲で対応 |

### ルールのカテゴリ

ルールのFrontmatterに記述する`category`とファイル名のPrefixの定義：

| カテゴリ | Prefix | 対象 |
|----------|--------|------|
| アーキテクチャ | `arch-` | レイヤー構成、モジュール化、設計パターン |
| データ | `data-` | データ取得、ページネーション、データベース |
| サーバーサイド保護 | `server-` | セキュリティ、環境変数、API保護 |
| スキーマ・型定義 | `schema-` | Zod、TypeScript、型推論 |
| レスポンス | `response-` | エラーハンドリング、レスポンス形式 |
| テスト | `test-` | テスト戦略、モック、ファイル配置 |
| バリデーション | `validation-` | 入力検証、パラメータ検証 |
| 命名規則 | `naming-` | ファイル名、関数名、変数名 |
| フロントエンド | `frontend-` | API呼び出し、Hooks、コンポーネント |


## 記述規則

### 見出し
- 階層を明確にする（H1 → H2 → H3）
- 体言止めで統一する
- 内容が分かる具体的な見出しをつける

**例**:
```markdown
NG: ## 設定
OK: ## 環境変数の設定
```

### 箇条書き
- 各項目は簡潔に記述する
- 並列な項目は同じ文末表現で統一する
- ネストは3階層までとする

### コード例
コードブロックには必ず言語を指定する：

```typescript
// OK: 言語指定あり
function example() {
  return true
}
```

コメントは日本語で記述する。

### 用語と表記
- 専門用語は初出時に定義する
- 英数字の前後に半角スペースを入れない
- カタカナは長音符を使用する（サーバー、ユーザー）
- 同じ概念には同じ用語を使用する

**用語統一の例**:
- OK: Repository
- NG: レポジトリ、リポジトリ（混在させない）

### ファイルパス
- 相対パスで記述する
- バッククォート（`` ` ``）で囲む
- ディレクトリは`/`で終わる

**例**:
```markdown
`guides/architecture.md`
`features/users/`
```


## 避けるべき表現

以下の表現は使用しない：

### 曖昧な表現
NG: たぶん、おそらく、かもしれない、など

### 主観的な評価
NG: 簡単、難しい、良い、悪い

代わりに具体的な基準を示す：
OK: 「3ステップで完了する」「5つのファイルを変更する必要がある」

### 時間的な推測
NG: すぐに、しばらく、少し

### 未定義の用語
初出時に必ず定義する。

### 冗長な表現
NG: 「基本的に」「一般的に」「ある程度」などの修飾語を避ける

### 絵文字
ユーザーが明示的に要求した場合を除き、絵文字は使用しない。


## レビューチェックリスト

### 概要レベルのガイドドキュメント

- [ ] 概要、設計思想、構成を含む
- [ ] Why（理由）が明確に説明されている
- [ ] 詳細ドキュメントへのリンクがある
- [ ] 用語が統一されている
- [ ] 誤字脱字がない

### 詳細レベルのガイドドキュメント

- [ ] 概要、設計思想、実装パターン、使用例を含む
- [ ] Why（理由）が明確に説明されている
- [ ] How（方法）が具体的なコード例で示されている
- [ ] 使用例が3つ以上ある
- [ ] コード例が動作可能である
- [ ] 用語が統一されている
- [ ] 誤字脱字がない

### ルールドキュメント

- [ ] Frontmatterが正しく記述されている
- [ ] ルールが明確に記述されている
- [ ] NG例とOK例の両方がある
- [ ] コード例にコメントで説明がある
- [ ] 理由（Why）セクションがある
- [ ] インパクトレベルが適切である
- [ ] カテゴリPrefixとファイル名が一致している
- [ ] 関連ガイドへのリンクがある

### SKILL.md

- [ ] Frontmatterがある
- [ ] アーキテクチャ概要（図、構成）がある
- [ ] ガイドとルールの違いの表がある
- [ ] すべてのガイドへのリンクがある
- [ ] ルールがカテゴリ別に整理されている
- [ ] インパクトレベルの定義がある
- [ ] ファイルパスが正しい
